{% extends 'member/base.html' %}
{% load static %} 
{% block page_title %}Attendance Record{% endblock %}

{% block title %} daily attendance {% endblock title%}
{% block content %}
  <div class="container">
    
    <!-- Display the attendance records -->
    <div class="mt-3">
      
      <table class="table">
        <thead>
          <tr>
          
            <th scope="col">Time</th>
            <th scope="col">Marked</th>
          </tr>
        </thead>
        <tbody>
          {% for record in attendance_records %}
            <tr>
              
              <td>{{ record.time }}</td>
              <td><input type="checkbox" checked disabled></td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="3">No attendance records found.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <form method="post" action="{% url 'mark_attendance' %}">
      {% csrf_token %}
      <input type="hidden" name="latitude" id="latitude" />
      <input type="hidden" name="longitude" id="longitude" />
      <input type="hidden" name="time" id="time" />

      <button type="submit" class="btn btn-primary btn-lg" style="background-color: rgb(16, 224, 103);" onclick="return showMessage()" data-toggle="tooltip" title="Click to mark attendance">Mark Attendance</button>

    </form>

    {% if messages %}
      <div class="mt-3">
        {% for message in messages %}
          <div class="alert {% if message.tags %}{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">Ã—</span>
            </button>
          </div>
        {% endfor %}
      </div>
    {% endif %}

  </div>

  <script>
    // Use Google Maps API to get user's location
    navigator.geolocation.getCurrentPosition(
      (position) => {
        document.getElementById('latitude').value = position.coords.latitude;
        document.getElementById('longitude').value = position.coords.longitude;
        document.getElementById('time').value = new Date().toISOString();  // Set the current timestamp
      },
      (error) => {
        console.error(error.message);
      }
    );

    function showMessage() {
      const card = document.createElement('div');
      card.classList.add('card');
      card.innerHTML = 'Attendance recorded successfully!';
      document.body.appendChild(card);

      // Display the card and hide it after 5 seconds
      card.style.display = 'block';
      setTimeout(function() {
        card.style.display = 'none';
        card.remove();
      }, 5000);

      return confirm('Are you sure you want to mark your attendance?');
    }
  </script>
{% endblock %}
